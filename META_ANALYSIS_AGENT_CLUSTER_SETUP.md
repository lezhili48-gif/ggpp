# 通过 Agent 集群写作完成 Meta 分析论文：从 0 到 1 搭建指南

> 目标：把你已有的“论文模板 + 方法”转化成可复用的多 Agent 协作流水线（检索、筛选、提取、统计、写作、质控、投稿材料）。

## 1. 先定义“最小可跑通版本”（MVP）

在搭建任何自动化之前，先把任务边界写清楚：

- 研究问题：PICO/PECO（对象、干预/暴露、对照、结局）
- 纳入排除标准：研究类型、时间范围、语言、终点定义
- 统计口径：效应量类型（OR/RR/HR/SMD/WMD）、模型（固定/随机）、异质性阈值
- 输出标准：你模板论文中的章节、图表、补充材料列表

**建议**：先只跑一个结局指标、20–30 篇文献，确保流程跑通再扩展。

## 2. Agent 集群角色设计（建议 8 个）

### A. PM/Orchestrator Agent（总控）
- 负责拆解任务、排期、状态机（待办/进行中/阻塞/完成）
- 给各 Agent 分配输入输出契约（JSON schema）
- 触发重试、人工复核和版本冻结

### B. Search Agent（检索）
- 根据方法学模板生成不同数据库检索式（PubMed/Embase/WoS/Cochrane）
- 输出标准字段：数据库、检索式、检索日期、命中数

### C. Screening Agent（标题摘要/全文筛选）
- 依据纳入排除标准做双通道筛选（A/B 两个独立 Agent）
- 冲突交由 Adjudication Agent 或人工仲裁
- 自动生成 PRISMA 流程图所需计数

### D. Data Extraction Agent（数据提取）
- 提取样本量、事件数、均值方差、随访时长、亚组变量等
- 每条提取必须保留“证据定位”（页码、表格编号、句子）

### E. Risk of Bias Agent（偏倚评估）
- 按研究类型调用 RoB2 / ROBINS-I / NOS / QUADAS-2 等框架
- 输出“判定 + 理由 + 证据原文”三元组

### F. Statistics Agent（统计）
- 计算合并效应、I²、Tau²、敏感性分析、亚组、Meta 回归
- 生成森林图、漏斗图、发表偏倚检验结果
- 固定输出可复现脚本（R 或 Python）

### G. Writing Agent（写作）
- 根据你的模板生成 IMRaD 各节初稿
- 自动引用结果表格和图编号
- 先“结构后润色”：先完整，再学术语言优化

### H. QA/Compliance Agent（质控合规）
- 对照 PRISMA 2020 清单逐项打勾
- 检查数据一致性（正文数字=表格数字=统计脚本输出）
- 生成投稿包：cover letter、亮点、图表清单、补充材料

## 3. 关键：统一数据契约（不统一就会失控）

建议你先定义 4 层统一格式：

1. `study_record.json`：文献元数据与筛选状态
2. `extraction_table.csv`：结构化提取字段
3. `analysis_config.yaml`：统计参数、亚组定义、阈值
4. `manuscript_map.yaml`：模板占位符与数据映射（例如图 2 对应哪个分析对象）

这样可以做到：替换模型不影响流程、替换期刊模板不重做分析。

## 4. 推荐执行流程（可直接落地）

1. **导入模板**：把你现有论文模板拆成占位符（如 `{{pooled_or_primary}}`）
2. **方法固化**：把你的方法学写成机器可读规则（纳排、效应量优先级、冲突规则）
3. **检索和去重**：Search Agent 产出候选集，统一 DOI/PMID 去重
4. **双通道筛选**：Screening A/B 并行，冲突进入仲裁
5. **结构化提取**：Extraction Agent 输出表格，低置信字段打标复核
6. **统计与作图**：Statistics Agent 执行脚本并固化随机种子与版本
7. **自动写作**：Writing Agent 按模板填充结果与图表引用
8. **终审质控**：QA Agent 跑 PRISMA + 一致性检查 + 复现实验
9. **冻结版本**：打标签（data vX / code vX / manuscript vX）

## 5. 你现在就可以做的“启动清单”（1 周）

### Day 1–2：准备资产
- 你的模板论文（Word/LaTeX）
- 方法学规范文档（纳排标准、统计口径）
- 5 篇已知金标准文献（用于校验提取准确率）

### Day 3：定义字段和规则
- 完成提取字段字典（字段名、类型、单位、缺失策略）
- 完成冲突仲裁规则（如优先全文、优先主分析、优先ITT）

### Day 4：搭建最小流水线
- 实现：检索 -> 去重 -> 筛选 -> 提取 -> 单一结局统计 -> 写作摘要段

### Day 5：评估与回归
- 指标：筛选一致率、提取准确率、统计复现率、文本事实错误率
- 产出：问题清单 + 下一轮迭代优先级

## 6. 人机协作边界（非常重要）

建议采用“AI 先做 + 人类终审”的分层：

- AI 可自动：检索式扩展、初筛、结构化提取、图表草稿、初稿写作
- 人类必须终审：纳排争议、偏倚高风险判断、统计模型选择、临床解释

> 原则：所有“结论性判断”必须有可追溯证据链。

## 7. 质量与风险控制建议

- 每条关键数据保留来源定位（PDF 页码 + 原句）
- 双 Agent 冗余（筛选/提取）降低幻觉风险
- 对最终统计结果做“独立脚本复算”
- 维护审计日志：谁在何时改了什么字段

## 8. 常见失败点与规避

- **失败点**：模板很好看，但字段没有标准化 -> 后续全靠手工粘贴
  - **规避**：先做 `manuscript_map.yaml`
- **失败点**：只做单 Agent，大量隐性错误无法发现
  - **规避**：关键环节双通道 + 仲裁
- **失败点**：统计脚本不可复现
  - **规避**：固定包版本、随机种子、输入快照

## 9. 如果你给我这 4 样东西，我可以直接帮你进入实操阶段

1. 你的论文模板（可脱敏）
2. 你的方法学草案（纳排 + 统计）
3. 目标疾病/结局
4. 期望工具栈（R、Python、Zotero、Ray/CrewAI/AutoGen 等）

我可以下一步为你输出：
- 一份可执行的 Agent 拓扑图（角色、输入输出、失败重试）
- 第一版字段字典（可直接用于提取）
- 写作模板占位符映射表
- MVP 的周计划和验收指标
